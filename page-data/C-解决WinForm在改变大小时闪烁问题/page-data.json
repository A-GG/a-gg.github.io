{"componentChunkName":"component---src-templates-blog-post-tsx-content-file-path-content-blog-c-解决-win-form在改变大小时闪烁问题-md","path":"/C-解决WinForm在改变大小时闪烁问题/","result":{"data":{"site":{"siteMetadata":{"title":"Wizard's Lair","postCopyright":true,"siteUrl":"https://wizd.dev","author":{"name":"w1zd"}}},"mdx":{"id":"53b9f162-7e0c-5c75-b356-a7fbc0611cac","excerpt":"问题发现 最近写WinForm程序的时候遇见一个问题，就是在拖动窗体改变大小的时候，窗体闪烁会非常严重。\n\n网上找的解决方案都是说用进行处理。\n\n双缓冲\n\n在图形图像处理编程过程中，双缓冲是一种基本的技术，如果窗体在响应OnPaint事件的时候要进行复杂的图形处理，那么窗体在重绘的时候由于过频的刷新而引起闪烁现象…","body":"\n## 问题发现\n最近写WinForm程序的时候遇见一个问题，就是在拖动窗体改变大小的时候，窗体闪烁会非常严重。\n\n网上找的解决方案都是说用`双缓冲`进行处理。\n\n## 双缓冲\n在图形图像处理编程过程中，双缓冲是一种基本的技术，如果窗体在响应OnPaint事件的时候要进行复杂的图形处理，那么窗体在重绘的时候由于过频的刷新而引起闪烁现象。\n使用双缓冲时，更新的图形首先被绘制到内存的缓冲区中，然后，此缓冲区的内容被迅速写入某些或所有显示的图面中。\n\n双缓冲实现过程如下：\n1、在内存中创建与画布一致的缓冲区\n2、在缓冲区画图\n3、将缓冲区位图拷贝到当前画布上\n4、释放内存缓冲区\n\n## 没用的方案\n下面列出来比较多见的一种做法：\n```csharp\nthis.SetStyle(ControlStyles.OptimizedDoubleBuffer | 　　\n                  ControlStyles.ResizeRedraw |\n                  ControlStyles.AllPaintingInWmPaint, true);\n```\n但是这样写之后，状况并没有太大的改善，在拖动窗体大小的时候，闪烁情况依旧非常明显。\n\n## 有用的方案(CreateParams)\n使用双缓冲之后并没有什么收获，所以，费劲九牛二虎之力的我找到了`CreateParams`这个东西。\n\n窗体和控件的属性`CreateParams`（这真的是一个属性）很神奇，因为通过它你能够很方便的控制窗体或控件诸如边框、最大化最小化关闭按钮的隐藏、窗体的模式化弹窗模式等的一些特性。\n\n那具体怎么操作呢？\n\n在主窗体的任意位置重写CreateParams，便能大幅改善闪烁的状况，代码如下：\n```csharp\nprotected override CreateParams CreateParams\n{\n    get\n    {\n        CreateParams cp = base.CreateParams;\n        cp.ExStyle |= 0x02000000;////用双缓冲绘制窗口的所有子控件\n        return cp;\n    }\n}\n```\n\n","fields":{"slug":"/C-解决WinForm在改变大小时闪烁问题/"},"frontmatter":{"title":"C#解决WinForm在改变大小时闪烁问题","date":"April 01, 2014","description":"最近写WinForm程序的时候遇见一个问题，就是在拖动窗体改变大小的时候，窗体闪烁会非常严重。","categories":["技术文章"],"tags":["CSharp",".NET","WinForm"],"toc":true}}},"pageContext":{"slug":"/C-解决WinForm在改变大小时闪烁问题/","previous":{"internal":{"contentFilePath":"/home/runner/work/w1zd.github.io/w1zd.github.io/content/blog/ASP-NET-MVC给母版页传递数据.md"},"fields":{"slug":"/ASP-NET-MVC给母版页传递数据/"},"frontmatter":{"title":"ASP.NET MVC给母版页传递数据"}},"next":{"internal":{"contentFilePath":"/home/runner/work/w1zd.github.io/w1zd.github.io/content/blog/Ubuntu-14-04-亮度BUG解决方案.md"},"fields":{"slug":"/Ubuntu-14-04-亮度BUG解决方案/"},"frontmatter":{"title":"Ubuntu 14.04 亮度BUG解决方案"}},"frontmatter":{"title":"C#解决WinForm在改变大小时闪烁问题","date":"2014-04-01T14:17:44.284Z","tags":["CSharp",".NET","WinForm"],"categories":["技术文章"],"description":"最近写WinForm程序的时候遇见一个问题，就是在拖动窗体改变大小的时候，窗体闪烁会非常严重。","toc":true}}},"staticQueryHashes":["2786614800","3000541721","3828236571"],"slicesMap":{}}