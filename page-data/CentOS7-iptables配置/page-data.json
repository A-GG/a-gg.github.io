{"componentChunkName":"component---src-templates-blog-post-tsx-content-file-path-content-blog-cent-os-7-iptables配置-md","path":"/CentOS7-iptables配置/","result":{"data":{"site":{"siteMetadata":{"title":"Wizard's Lair","postCopyright":true,"siteUrl":"https://wizd.dev","author":{"name":"w1zd"}}},"mdx":{"id":"26fbcea6-e488-56de-9712-79ee64904c1f","excerpt":"CentOS7使用的防火墙默认为firewalle,本篇文章主要讲述如何在CentOS7中安装和使用iptables防火墙。 安装iptable iptable-service\n\n禁用/停止自带的firewalld服务\n\n设置现有规则\n\n其他规则设定\n\n保存规则设定\n\n开启iptables服务\n\n解决vsftpd在ip…","body":"\nCentOS7使用的防火墙默认为firewalle,本篇文章主要讲述如何在CentOS7中安装和使用iptables防火墙。\n\n安装iptable iptable-service\n\n```bash\n#先检查是否安装了iptables\nservice iptables status\n#安装iptables\nyum install -y iptables\n#升级iptables\nyum update iptables \n#安装iptables-services\nyum install iptables-services\n```\n禁用/停止自带的firewalld服务\n\n```bash\n#停止firewalld服务\nsystemctl stop firewalld\n#禁用firewalld服务\nsystemctl mask firewalld\n```\n\n设置现有规则\n\n```bash\n#查看iptables现有规则\niptables -L -n\n#先允许所有,不然有可能会杯具\niptables -P INPUT ACCEPT\n#清空所有默认规则\niptables -F\n#清空所有自定义规则\niptables -X\n#所有计数器归0\niptables -Z\n#允许来自于lo接口的数据包(本地访问)\niptables -A INPUT -i lo -j ACCEPT\n#开放22端口\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\n#开放21端口(FTP)\niptables -A INPUT -p tcp --dport 21 -j ACCEPT\n#开放80端口(HTTP)\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\n#开放443端口(HTTPS)\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\n#允许ping\niptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT\n#允许接受本机请求之后的返回数据 RELATED,是为FTP设置的\niptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT\n#其他入站一律丢弃\niptables -P INPUT DROP\n#所有出站一律绿灯\niptables -P OUTPUT ACCEPT\n#所有转发一律丢弃\niptables -P FORWARD DROP\n```\n其他规则设定\n\n```bash\n#如果要添加内网ip信任（接受其所有TCP请求）\niptables -A INPUT -p tcp -s 45.96.174.68 -j ACCEPT\n#过滤所有非以上规则的请求\niptables -P INPUT DROP\n#要封停一个IP，使用下面这条命令：\niptables -I INPUT -s ***.***.***.*** -j DROP\n#要解封一个IP，使用下面这条命令:\niptables -D INPUT -s ***.***.***.*** -j DROP\n```\n保存规则设定\n\n```bash\n#保存上述规则\nservice iptables save\n```\n开启iptables服务 \n\n```bash\n#注册iptables服务\n#相当于以前的chkconfig iptables on\nsystemctl enable iptables.service\n#开启服务\nsystemctl start iptables.service\n#查看状态\nsystemctl status iptables.service\n```\n\n解决vsftpd在iptables开启后,无法使用被动模式的问题\n\n1.首先在/etc/sysconfig/iptables-config中修改或者添加以下内容\n\n```bash\n#添加以下内容,注意顺序不能调换\nIPTABLES_MODULES=\"ip_conntrack_ftp\"\nIPTABLES_MODULES=\"ip_nat_ftp\"\n```\n2.重新设置iptables设置\n\n```bash\niptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT\n```\n\n**以下为完整设置脚本**\n```bash\n#!/bin/sh\niptables -P INPUT ACCEPT\niptables -F\niptables -X\niptables -Z\niptables -A INPUT -i lo -j ACCEPT\niptables -A INPUT -p tcp --dport 22 -j ACCEPT\niptables -A INPUT -p tcp --dport 21 -j ACCEPT\niptables -A INPUT -p tcp --dport 80 -j ACCEPT\niptables -A INPUT -p tcp --dport 443 -j ACCEPT\niptables -A INPUT -p icmp --icmp-type 8 -j ACCEPT\niptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\nservice iptables save\nsystemctl restart iptables.service\n```\n\n##如何删除单条规则？\n```bash\n#先使用行号显示所有规则\niptables -t nat -L -n --line-numbers\n#找到要删除的规则，确认前面的行号，使用下面的命令进行删除\niptables -t nat -D PREROUTING 行号\n```\n\n##如何删除多条规则？\n```bash\n#将所有的iptables规则导出到iptableRules文件\niptables-save > iptablesRules\n#打开该文件，将你不想要的所有规则都删掉，改完记得保存\n#保存完之后使用该文件重新配置iptables\niptables-restore < iptablesRules\n```\n","fields":{"slug":"/CentOS7-iptables配置/"},"frontmatter":{"title":"CentOS7 iptables配置","date":"September 18, 2016","description":"CentOS7使用的防火墙默认为firewalle,本篇文章主要讲述如何在CentOS7中安装和使用iptables防火墙。","categories":["技术文章"],"tags":["CentOS"],"toc":null}}},"pageContext":{"slug":"/CentOS7-iptables配置/","previous":{"internal":{"contentFilePath":"/home/runner/work/w1zd.github.io/w1zd.github.io/content/blog/Block机制详解.md"},"fields":{"slug":"/Block机制详解/"},"frontmatter":{"title":"Block机制详解"}},"next":{"internal":{"contentFilePath":"/home/runner/work/w1zd.github.io/w1zd.github.io/content/blog/JavaScript预解析.md"},"fields":{"slug":"/JavaScript预解析/"},"frontmatter":{"title":"JavaScript预解析"}},"frontmatter":{"title":"CentOS7 iptables配置","date":"2016-09-18T17:49:39.284Z","tags":["CentOS"],"categories":["技术文章"],"description":"CentOS7使用的防火墙默认为firewalle,本篇文章主要讲述如何在CentOS7中安装和使用iptables防火墙。"}}},"staticQueryHashes":["2786614800","3000541721","3828236571"],"slicesMap":{}}