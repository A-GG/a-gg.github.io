"use strict";(self.webpackChunkw1zd_lair=self.webpackChunkw1zd_lair||[]).push([[6079],{9632:function(e,a,n){n.r(a),n.d(a,{default:function(){return b}});var s=n(8453),t=n(6540);function l(e){const a=Object.assign({p:"p",span:"span",strong:"strong"},(0,s.RP)(),e.components);return t.createElement(t.Fragment,null,t.createElement(a.p,null,"CentOS7使用的防火墙默认为firewalle,本篇文章主要讲述如何在CentOS7中安装和使用iptables防火墙。"),"\n",t.createElement(a.p,null,"安装iptable iptable-service"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#先检查是否安装了iptables</span>\n<span class="token function">service</span> iptables status\n<span class="token comment">#安装iptables</span>\nyum <span class="token function">install</span> -y iptables\n<span class="token comment">#升级iptables</span>\nyum update iptables \n<span class="token comment">#安装iptables-services</span>\nyum <span class="token function">install</span> iptables-services</code></pre></div>'}}),"\n",t.createElement(a.p,null,"禁用/停止自带的firewalld服务"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#停止firewalld服务</span>\nsystemctl stop firewalld\n<span class="token comment">#禁用firewalld服务</span>\nsystemctl mask firewalld</code></pre></div>'}}),"\n",t.createElement(a.p,null,"设置现有规则"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#查看iptables现有规则</span>\niptables -L -n\n<span class="token comment">#先允许所有,不然有可能会杯具</span>\niptables -P INPUT ACCEPT\n<span class="token comment">#清空所有默认规则</span>\niptables -F\n<span class="token comment">#清空所有自定义规则</span>\niptables -X\n<span class="token comment">#所有计数器归0</span>\niptables -Z\n<span class="token comment">#允许来自于lo接口的数据包(本地访问)</span>\niptables -A INPUT -i lo -j ACCEPT\n<span class="token comment">#开放22端口</span>\niptables -A INPUT -p tcp --dport <span class="token number">22</span> -j ACCEPT\n<span class="token comment">#开放21端口(FTP)</span>\niptables -A INPUT -p tcp --dport <span class="token number">21</span> -j ACCEPT\n<span class="token comment">#开放80端口(HTTP)</span>\niptables -A INPUT -p tcp --dport <span class="token number">80</span> -j ACCEPT\n<span class="token comment">#开放443端口(HTTPS)</span>\niptables -A INPUT -p tcp --dport <span class="token number">443</span> -j ACCEPT\n<span class="token comment">#允许ping</span>\niptables -A INPUT -p icmp --icmp-type <span class="token number">8</span> -j ACCEPT\n<span class="token comment">#允许接受本机请求之后的返回数据 RELATED,是为FTP设置的</span>\niptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT\n<span class="token comment">#其他入站一律丢弃</span>\niptables -P INPUT DROP\n<span class="token comment">#所有出站一律绿灯</span>\niptables -P OUTPUT ACCEPT\n<span class="token comment">#所有转发一律丢弃</span>\niptables -P FORWARD DROP</code></pre></div>'}}),"\n",t.createElement(a.p,null,"其他规则设定"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#如果要添加内网ip信任（接受其所有TCP请求）</span>\niptables -A INPUT -p tcp -s <span class="token number">45.96</span>.174.68 -j ACCEPT\n<span class="token comment">#过滤所有非以上规则的请求</span>\niptables -P INPUT DROP\n<span class="token comment">#要封停一个IP，使用下面这条命令：</span>\niptables -I INPUT -s ***.***.***.*** -j DROP\n<span class="token comment">#要解封一个IP，使用下面这条命令:</span>\niptables -D INPUT -s ***.***.***.*** -j DROP</code></pre></div>'}}),"\n",t.createElement(a.p,null,"保存规则设定"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#保存上述规则</span>\n<span class="token function">service</span> iptables save</code></pre></div>'}}),"\n",t.createElement(a.p,null,"开启iptables服务"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#注册iptables服务</span>\n<span class="token comment">#相当于以前的chkconfig iptables on</span>\nsystemctl <span class="token builtin class-name">enable</span> iptables.service\n<span class="token comment">#开启服务</span>\nsystemctl start iptables.service\n<span class="token comment">#查看状态</span>\nsystemctl status iptables.service</code></pre></div>'}}),"\n",t.createElement(a.p,null,"解决vsftpd在iptables开启后,无法使用被动模式的问题"),"\n",t.createElement(a.p,null,"1.首先在/etc/sysconfig/iptables-config中修改或者添加以下内容"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#添加以下内容,注意顺序不能调换</span>\n<span class="token assign-left variable">IPTABLES_MODULES</span><span class="token operator">=</span><span class="token string">"ip_conntrack_ftp"</span>\n<span class="token assign-left variable">IPTABLES_MODULES</span><span class="token operator">=</span><span class="token string">"ip_nat_ftp"</span></code></pre></div>'}}),"\n",t.createElement(a.p,null,"2.重新设置iptables设置"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash">iptables -A INPUT -m state --state  RELATED,ESTABLISHED -j ACCEPT</code></pre></div>'}}),"\n",t.createElement(a.p,null,t.createElement(a.strong,null,"以下为完整设置脚本")),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token shebang important">#!/bin/sh</span>\niptables -P INPUT ACCEPT\niptables -F\niptables -X\niptables -Z\niptables -A INPUT -i lo -j ACCEPT\niptables -A INPUT -p tcp --dport <span class="token number">22</span> -j ACCEPT\niptables -A INPUT -p tcp --dport <span class="token number">21</span> -j ACCEPT\niptables -A INPUT -p tcp --dport <span class="token number">80</span> -j ACCEPT\niptables -A INPUT -p tcp --dport <span class="token number">443</span> -j ACCEPT\niptables -A INPUT -p icmp --icmp-type <span class="token number">8</span> -j ACCEPT\niptables -A INPUT -m state --state RELATED,ESTABLISHED -j ACCEPT\niptables -P INPUT DROP\niptables -P OUTPUT ACCEPT\niptables -P FORWARD DROP\n<span class="token function">service</span> iptables save\nsystemctl restart iptables.service</code></pre></div>'}}),"\n",t.createElement(a.p,null,"##如何删除单条规则？"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#先使用行号显示所有规则</span>\niptables -t nat -L -n --line-numbers\n<span class="token comment">#找到要删除的规则，确认前面的行号，使用下面的命令进行删除</span>\niptables -t nat -D PREROUTING 行号</code></pre></div>'}}),"\n",t.createElement(a.p,null,"##如何删除多条规则？"),"\n",t.createElement(a.span,{dangerouslySetInnerHTML:{__html:'<div class="gatsby-highlight" data-language="bash"><pre class="language-bash"><code class="language-bash"><span class="token comment">#将所有的iptables规则导出到iptableRules文件</span>\niptables-save <span class="token operator">></span> iptablesRules\n<span class="token comment">#打开该文件，将你不想要的所有规则都删掉，改完记得保存</span>\n<span class="token comment">#保存完之后使用该文件重新配置iptables</span>\niptables-restore <span class="token operator">&lt;</span> iptablesRules</code></pre></div>'}}))}var p=function(e){void 0===e&&(e={});const{wrapper:a}=Object.assign({},(0,s.RP)(),e.components);return a?t.createElement(a,e,t.createElement(l,e)):l(e)},c=n(1468),r=n(7947),o=n(1327),i=n(2171),m=n(9739);const g=e=>{let{data:a,pageContext:n,children:l}=e;const p=a.mdx,{title:g,postCopyright:b,author:u,siteUrl:d}=a.site.siteMetadata,{previous:E,next:h}=n,k=(0,c.d4)((e=>e.isDarkMode));return(0,t.useEffect)((()=>{(0,m.A)(".post-content img",{background:"#292a2d"})}),[]),t.createElement(r.A,{isFocus:!1,title:p.frontmatter.title,description:p.frontmatter.description},t.createElement("div",{className:"container"},t.createElement("article",{className:"post-wrap"},t.createElement("header",{className:"post-header"},t.createElement("h1",{className:"post-title"},p.frontmatter.title),t.createElement("div",{className:"post-meta"},t.createElement("span",{className:"post-time"},p.frontmatter.date)," ")),t.createElement("div",{className:"post-content"},t.createElement(s.xA,null,l)),b&&t.createElement("section",{className:"post-copyright"},t.createElement("p",{className:"copyright-item"},t.createElement("span",null,"Author: "),t.createElement("span",null,u.name)),t.createElement("p",{className:"copyright-item"},t.createElement("span",null,"Permalink:"),t.createElement("span",null,t.createElement("a",{href:d+p.fields.slug}," ",d+p.fields.slug," "))),t.createElement("p",{className:"copyright-item"},t.createElement("span",null,"License: "),t.createElement("span",null,t.createElement("a",{href:"http://creativecommons.org/licenses/by-nc/4.0/"},"CC-BY-NC-4.0")))),t.createElement("section",{className:"post-tags"},t.createElement("div",null,t.createElement("span",null,"Tag(s):"),t.createElement("span",{className:"tag"},0!==p.frontmatter.tags.length&&p.frontmatter.tags.map((e=>t.createElement("a",{key:e,href:`/tag/${e}`},"#",e))))),t.createElement("div",null,t.createElement("a",{href:"#/",onClick:()=>{window.history.back()}},"back"),t.createElement("span",null," · "),t.createElement("a",{href:a.site.siteMetadata.siteUrl},"home"))),t.createElement("section",{className:"post-nav"},E?t.createElement("a",{className:"prev",rel:"prev",href:E.fields.slug},E.frontmatter.title):t.createElement("span",{className:"prev"},"No More"),h?t.createElement("a",{className:"next",rel:"next",href:h.fields.slug},h.frontmatter.title):t.createElement("span",{className:"next"},"No More")),t.createElement(i.A,{id:"comment",repo:"w1zd/w1zd.github.io",repoId:"MDEwOlJlcG9zaXRvcnkyODg3MTA5NjA=",category:"Announcements",categoryId:"MDE4OkRpc2N1c3Npb25DYXRlZ29yeTMzMDE1OTcy",mapping:"og:title",theme:`https://wizd.dev/giscus-themes/${k?"dark":"light"}.css`,reactionsEnabled:"1",loading:"lazy"}),p.frontmatter.toc&&t.createElement(o.A,null))))};function b(e){return t.createElement(g,e,t.createElement(p,e))}}}]);
//# sourceMappingURL=component---src-templates-blog-post-tsx-content-file-path-content-blog-cent-os-7-iptables配置-md-83dd4dc2c447d4ebf18f.js.map